<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HARRY6</title>

  <style>
    :root{
      --text:#111;
      --muted: rgba(0,0,0,.48);
      --muted2: rgba(0,0,0,.30);
      --line: rgba(0,0,0,.10);
      --leftPad: 56px;
      --panelW: 360px;
      --panelPad: 18px;
    }
    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      margin:0;
      background:#fff;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "PingFang SC","Microsoft YaHei", sans-serif;
    }

    /* p5 stage */
    #stage{
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 1;
    }
    canvas{ display:block; pointer-events:auto; }

    /* brand */
    .brand{
      position:fixed;
      top:44px;
      left:var(--leftPad);
      z-index:1000;
      text-decoration:none;
      color:var(--text);
      font-weight:600;
      font-size:18px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .brand:hover{ opacity:.78; }

    /* nav */
    .nav{
      position:fixed;
      left:var(--leftPad);
      top:50%;
      transform:translateY(-50%);
      z-index:1000;
      user-select:none;
    }
    .navItem{ margin: 18px 0; }

    .navBtn{
      display:inline-block;
      cursor:pointer;
      border:none;
      background: #ffffff;
      padding: 10px 12px;
      margin-left:-12px;
      font-size:15px;
      letter-spacing:.24em;
      text-transform:uppercase;
      color:var(--text);
      border-radius: 999px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .navBtn:hover{
      color:var(--text);
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .navBtn.is-active{ color:var(--text); }

    /* panel */
    .panel{
      position:fixed;
      width: var(--panelW);
      max-width: calc(100vw - 24px);
      background:#fff;
      border:1px solid var(--line);
      padding: var(--panelPad);
      z-index:1001;
      opacity:0;
      pointer-events:none;
      transform: translateY(-8px);
      transition: opacity .14s ease, transform .14s ease;
    }
    .panel.is-open{
      opacity:1;
      pointer-events:auto;
      transform: translateY(0);
    }
    .panel::before{
      content:"";
      position:absolute;
      left:-18px;
      top:0;
      width:18px;
      height:100%;
      background:transparent;
    }

    .panelList{ list-style:none; padding:0; margin:0; }
    .panelList li{ margin: 10px 0; }

    .panelLink{
      text-decoration:none;
      color:var(--text);
      font-size:16px;
      letter-spacing:.02em;
      display:inline-block;
      padding: 6px 4px;
    }
    .panelLink:hover{ opacity:.75; }
    .panelLink .year{
      color:var(--muted);
      margin-left:.35em;
      letter-spacing:.06em;
    }

    /* email */
    .emailWrap{
      position:fixed;
      left:50%;
      bottom:28px;
      transform:translateX(-50%);
      z-index:1000;
      font-size:13px;
      letter-spacing:.06em;
      color:var(--muted);
      text-align: center;
    }
    .emailCopy{
      cursor:pointer;
      padding: 6px 10px;
      border:1px solid transparent;
      border-radius:999px;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: border-color .15s ease, color .15s ease, box-shadow .15s ease;
    }
    .emailCopy:hover{
      border-color: var(--line);
      color: var(--text);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .hint{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(0,0,0,.6);
      margin-bottom: 8px;
      display: none;
      font-weight: 500;
    }

    .toast{
      position:absolute;
      left:100%;
      top:50%;
      transform: translate(10px,-50%);
      font-size:12px;
      color:var(--muted2);
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .toast.show{ opacity:1; }

    @media (max-width: 1024px){
      :root{ --leftPad: 22px; --panelW: 320px; }
      .brand{ top:22px; }
      .navBtn{ font-size:14px; letter-spacing:.20em; }
      .hint{ display: block; }
    }
  </style>
</head>

<body>

  <a id="homeLink" class="brand" href="#">HARRY6</a>

  <nav class="nav" aria-label="Primary">
    <div class="navItem" data-menu="projects"><button class="navBtn" type="button">PROJECTS</button></div>
    <div class="navItem" data-menu="images"><button class="navBtn" type="button">IMAGES</button></div>
    <div class="navItem" data-menu="about"><button class="navBtn" type="button">ABOUT</button></div>
  </nav>

  <div id="panel" class="panel" role="dialog" aria-hidden="true">
    <ul id="panelList" class="panelList"></ul>
  </div>

  <div class="emailWrap">
    <div class="hint">左右滑动 · 互动</div>
    <span id="emailCopy" class="emailCopy" title="Click to copy">wenhao_liu888@163.com</span>
    <span id="toast" class="toast">COPIED</span>
  </div>

  <div id="stage"></div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>

  <script>
    // ===== 导航和面板逻辑 =====
    const REPO = location.pathname.split("/")[1];
    const BASE = REPO ? `/${REPO}/` : "/";
    document.getElementById("homeLink").setAttribute("href", BASE);

    const PROJECTS = [
      { title: "Yellow River", year: "2025", href: BASE + "projects/yellow-river/" },
      { title: "Frontispiece", year: "2024", href: BASE + "projects/frontispiece/" },
      { title: "Formless Buddha", year: "2023", href: BASE + "projects/formless-buddha/" },
      { title: "Yellow", year: "2021", href: BASE + "projects/yellow/" }
    ];

    const IMAGES = [
      { title: "Yellow River", year: "2025", href: BASE + "images/yellow-river/" }
    ];

    const ABOUT_HREF = BASE + "about/";

    const panel = document.getElementById("panel");
    const panelList = document.getElementById("panelList");
    const items = Array.from(document.querySelectorAll(".navItem"));
    const btns  = Array.from(document.querySelectorAll(".navBtn"));

    let activeKey = null;
    let closeTimer = null;

    function setActiveButton(key){
      btns.forEach(b => b.classList.remove("is-active"));
      const item = items.find(i => i.dataset.menu === key);
      if(item) item.querySelector(".navBtn").classList.add("is-active");
    }

    function renderList(list){
      panelList.innerHTML = list.map(it => `
        <li>
          <a class="panelLink" href="${it.href}">
            ${it.title} <span class="year">— ${it.year}</span>
          </a>
        </li>
      `).join("");
    }

    function positionPanelNearButton(btn){
      const r = btn.getBoundingClientRect();
      const gap = 14;
      let left = Math.round(r.right + gap);
      let top  = Math.round(r.top + r.height/2);

      panel.style.top = `${top}px`;
      panel.style.transform = "translateY(-50%)";

      const panelWidth = Math.min(panel.offsetWidth || 360, window.innerWidth - 24);
      if(left + panelWidth + 12 > window.innerWidth){
        left = Math.round(r.left - gap - panelWidth);
      }
      left = Math.max(12, left);
      panel.style.left = `${left}px`;
    }

    function openPanelFor(key, btn){
      clearTimeout(closeTimer);
      activeKey = key;
      setActiveButton(key);

      if(key === "projects") renderList(PROJECTS);
      if(key === "images") renderList(IMAGES);

      panel.classList.add("is-open");
      panel.setAttribute("aria-hidden","false");
      requestAnimationFrame(() => positionPanelNearButton(btn));
    }

    function closePanel(){
      activeKey = null;
      btns.forEach(b => b.classList.remove("is-active"));
      panel.classList.remove("is-open");
      panel.setAttribute("aria-hidden","true");
    }

    function scheduleClose(){
      clearTimeout(closeTimer);
      closeTimer = setTimeout(closePanel, 220);
    }

    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    items.forEach(item => {
      const key = item.dataset.menu;
      const btn = item.querySelector(".navBtn");

      if(!isTouchDevice && (key === "projects" || key === "images")){
        item.addEventListener("mouseenter", () => openPanelFor(key, btn));
        item.addEventListener("mouseleave", scheduleClose);
      }

      btn.addEventListener("click", (e) => {
        if(key === "about"){
          window.location.href = ABOUT_HREF;
          e.preventDefault();
          return;
        }
        if(panel.classList.contains("is-open") && activeKey === key){
          closePanel();
        }else{
          openPanelFor(key, btn);
        }
        e.preventDefault();
      });
    });

    panel.addEventListener("mouseenter", () => clearTimeout(closeTimer));
    panel.addEventListener("mouseleave", scheduleClose);

    document.addEventListener("mousedown", (e) => {
      const isNav = e.target.closest(".nav");
      const isPanel = e.target.closest("#panel");
      if(!isNav && !isPanel && panel.classList.contains("is-open")) closePanel();
    });

    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && panel.classList.contains("is-open")) closePanel();
    });

    // 邮箱复制
    const emailEl = document.getElementById("emailCopy");
    const toast = document.getElementById("toast");
    let toastTimer = null;

    async function copyEmail(){
      const text = emailEl.textContent.trim();
      try{
        await navigator.clipboard.writeText(text);
      }catch(err){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.remove("show"), 900);
    }
    emailEl.addEventListener("click", copyEmail);
  </script>

  <script>
    // ===== P5.js 动画（必须分开一个 script 标签）=====
    // 等待页面完全加载后再执行
    window.addEventListener('load', function() {
      console.log("页面完全加载，开始初始化 p5.js");

      let particles = [];
      let numParticles = 50;

      // 创建 p5 实例
      new p5(function(p) {
        p.setup = function() {
          // 根据窗口大小创建 canvas，但保持最大尺寸
          let w = Math.min(p.windowWidth * 0.9, 1200);
          let h = Math.min(p.windowHeight * 0.8, 800);
          let cnv = p.createCanvas(w, h);
          cnv.parent("stage");
          p.pixelDensity(1);
          p.frameRate(60);

          console.log("Canvas 尺寸:", p.width, "x", p.height);

          // 创建粒子
          for (let i = 0; i < numParticles; i++) {
            particles.push(new Particle(p));
          }
        };

        p.draw = function() {
          p.background(250);

          // 检测设备类型
          let pointerX = p.mouseX;
          if (p.touches.length > 0) {
            pointerX = p.touches[0].x;
          }

          let distFromCenter = p.abs(p.width / 2 - pointerX);
          let intensity = p.map(distFromCenter, 0, p.width / 2, 0, 1);

          // 更新和绘制粒子
          for (let i = 0; i < particles.length; i++) {
            particles[i].update(intensity);
            particles[i].display();
          }

          // 连线
          p.stroke(200, 150);
          p.strokeWeight(0.5);
          for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
              let d = p.dist(particles[i].pos.x, particles[i].pos.y, particles[j].pos.x, particles[j].pos.y);
              if (d < 80) {
                p.line(particles[i].pos.x, particles[i].pos.y, particles[j].pos.x, particles[j].pos.y);
              }
            }
          }

          // 中心圆
          p.noStroke();
          let centerSize = p.map(p.sin(p.frameCount * 0.02), -1, 1, 60, 100) + intensity * 50;
          p.fill(50, 100, 200, 180);
          p.ellipse(p.width / 2, p.height / 2, centerSize, centerSize);

          // 文字
          p.fill(80);
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(32);
          p.text("HARRY6", p.width / 2, p.height / 2 - 120);
          p.textSize(13);
          p.fill(150);
          p.text("Slide to interact", p.width / 2, p.height / 2 + 120);
        };

        p.windowResized = function() {
          let w = Math.min(p.windowWidth * 0.9, 1200);
          let h = Math.min(p.windowHeight * 0.8, 800);
          p.resizeCanvas(w, h);
          particles = [];
          for (let i = 0; i < numParticles; i++) {
            particles.push(new Particle(p));
          }
        };

        p.touchStarted = function() {
          if (p.mouseX > 0 && p.mouseX < p.width && p.mouseY > 0 && p.mouseY < p.height) {
            return false;
          }
          return true;
        };

        // 粒子类
        class Particle {
          constructor(p) {
            this.p = p;
            this.pos = p5.Vector.random2D().mult(p.random(p.width/2));
            this.pos.add(p.createVector(p.width/2, p.height/2));
            this.vel = p.createVector(p.random(-1, 1), p.random(-1, 1));
            this.size = p.random(3, 8);
            this.color = p.color(50 + p.random(50), 100 + p.random(100), 200 - p.random(50), 180);
          }

          update(intensity) {
            this.pos.add(this.vel);

            if (this.pos.x < 0 || this.pos.x > this.p.width) this.vel.x *= -1;
            if (this.pos.y < 0 || this.pos.y > this.p.height) this.vel.y *= -1;

            let d = this.p.dist(this.p.mouseX, this.p.mouseY, this.pos.x, this.pos.y);
            if (d < 100) {
              let force = p5.Vector.sub(this.pos, this.p.createVector(this.p.mouseX, this.p.mouseY));
              force.setMag(0.5);
              this.vel.add(force);
            }

            this.vel.limit(3 + intensity * 2);
          }

          display() {
            this.p.noStroke();
            this.p.fill(this.color);
            this.p.ellipse(this.pos.x, this.pos.y, this.size, this.size);
          }
        }
      });
    });
  </script>

</body>
</html>
